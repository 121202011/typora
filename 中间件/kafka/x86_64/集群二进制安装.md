

| 服务名称 | 下载地址                           | 备注 |
| -------- | ---------------------------------- | ---- |
| kafka    | https://kafka.apache.org/downloads |      |

### kafka安装部署

解压文件（三台机器）

```bash
tar -xzf kafka_2.13-3.1.0.tgz
```

添加软连接（三台机器）

```bash
ln -s kafka_2.13-3.1.0  kafka
```

创建存储路径（三台机器）

```bash
cd kafka
mkdir /opt/zookeeper/data
```

修改zookeeper.properties配置文件（三台机器）

```bash
#复制 ZooKeeper 配置文件
cp  config/zookeeper.properties config/zookeeper.properties.bak

#编辑配置文件
vim config/zookeeper.properties
tickTime=2000
initLimit=10
syncLimit=5
dataDir=/opt/zookeeper/data
clientPort=2181
server.1=172.24.100.186:2888:3888
server.2=172.24.100.187:2888:3888
server.3=172.24.100.188:2888:3888

#在 dataDir 目录下创建 myid 文件，并写入当前服务器的编号（对应 server.x 中的 x）
echo "1" >/opt/zookeeper/data/myid
```

修改server.properties配置文件（三台机器）

```bash
#复制 Kafka 配置文件
cp config/server.properties config/server.properties.bak

#编辑 config/server.properties 文件 (broker.id 每台服务器的唯一编号)
vim config/server.properties
broker.id=1
host.name=172.24.100.186
num.network.threads=3
num.io.threads=8
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
socket.request.max.bytes=104857600
log.dirs=/opt/kafka/logs/
num.partitions=1
num.recovery.threads.per.data.dir=1
offsets.topic.replication.factor=1
transaction.state.log.replication.factor=1
transaction.state.log.min.isr=1
log.cleanup.policy=delete
log.retention.hours=168
log.segment.bytes=1073741824
log.retention.check.interval.ms=300000
zookeeper.connect=172.24.100.186:2181,172.24.100.187:2181,172.24.100.188:2181
zookeeper.connection.timeout.ms=6000
group.initial.rebalance.delay.ms=0
#listeners=PLAINTEXT://172.24.100.186:9092

#开启plain认证
listeners=SASL_PLAINTEXT://172.24.100.186:9092
security.inter.broker.protocol= SASL_PLAINTEXT
sasl.mechanism.inter.broker.protocol=PLAIN
sasl.enabled.mechanisms=PLAIN

#添加权限认证
authorizer.class.name=kafka.security.authorizer.AclAuthorizer
super.users=User:admin
```

为 Kafka 服务器配置基于 PLAIN 机制的身份验证（三台机器）

```bash
配置 PLAIN 认证
vim kafka_server_jaas.conf
KafkaServer {
   org.apache.kafka.common.security.plain.PlainLoginModule required
   username="admin"
   password="jZ1]uD3&uP4-wZ"
   user_admin="jZ1]uD3&uP4-wZ"
   user_log="cC4_zM0]nF3!nH";
};
```

添加 KAFKA_OPTS 环境变量让 Kafka 在启动时加载 JAAS 配置文件，以支持 PLAIN 认证（三台机器）

```bash
vim kafka-run-class.sh
KAFKA_OPTS="-Djava.security.auth.login.config=/opt/kafka/config/kafka_server_jaas.conf
```

客户端配置文件（三台机器）

```bash
vim kafka_client_auth.conf
security.protocol=SASL_PLAINTEXT
sasl.mechanism=PLAIN
sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username="log" password="cC4_zM0]nF3!nH";
```

客户端配置文件（三台机器）

```bash
vim  kafka_client_auth_admin.conf
security.protocol=SASL_PLAINTEXT
sasl.mechanism=PLAIN
sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username="admin" password="jZ1]uD3&uP4-wZ";
```

服务启动与停止（三台机器）

```bash
#zk服务启动
./bin/zookeeper-server-start.sh -daemon config/zookeeper.properties

#停止服务
./bin/zookeeper-server-stop.sh

#kafka服务启动
bin/kafka-server-start.sh -daemon config/server.properties

#停止服务
bin/kafka-server-stop.sh

#查看topic清单列表
./bin/kafka-topics.sh --bootstrap-server 172.24.100.186:9092 --list --command-config config/kafka_client_auth_admin.conf
./bin/kafka-topics.sh --bootstrap-server 172.24.100.186:9092 --list --command-config config/kafka_client_auth.conf
```